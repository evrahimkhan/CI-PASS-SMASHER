name: John the Ripper Password Cracking

on:
  workflow_dispatch:
    inputs:
      file-path:
        description: 'Path to the file to crack (direct path in repo)'
        required: true
        default: 'sample-protected-document.md'
      wordlist-url:
        description: 'URL to download wordlist from (optional)'
        required: false
      custom-rules:
        description: 'Custom John the Ripper rules to apply (optional)'
        required: false
      timeout:
        description: 'Timeout in seconds'
        required: false
        default: '3600'
      telegram-token:
        description: 'Telegram bot token for notifications (optional)'
        required: false
      telegram-chat-id:
        description: 'Telegram chat ID for notifications (optional)'
        required: false

permissions:
  contents: read

jobs:
  crack-password:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Display repository structure
        run: |
          echo "Repository structure:"
          find . -type f -name "*.md" -o -name "*.pdf" -o -name "*.doc*" -o -name "*.zip" -o -name "*.rar" | head -20

      - name: Validate file exists
        run: |
          if [ ! -f "${{ inputs.file-path }}" ]; then
            echo "Error: File does not exist at path ${{ inputs.file-path }}"
            echo "Available files in repository:"
            find . -type f -not -path "./.git/*" | head -20
            exit 1
          fi
          echo "File found: ${{ inputs.file-path }}"
          ls -la "${{ inputs.file-path }}"

      - name: Run John the Ripper Action
        uses: ./ci-pass-cracker
        with:
          file-path: ${{ inputs.file-path }}
          wordlist-url: ${{ inputs.wordlist-url }}
          custom-rules: ${{ inputs.custom-rules }}
          timeout: ${{ inputs.timeout }}
          telegram-token: ${{ inputs.telegram-token }}
          telegram-chat-id: ${{ inputs.telegram-chat-id }}

      - name: Display results
        run: |
          echo "Password cracking attempt completed"
          echo "Check the action logs for results"
          echo "File processed: ${{ inputs.file-path }}"